### 总体架构：智能体协同教学助手

我们将整个教学过程划分为四个阶段，每个阶段由一个专门的智能体负责。

1. **情境与任务智能体 (Agent A)**：负责情境生成、S-T-W支架引导、任务分解。
2. **逻辑与设计智能体 (Agent B)**：负责概念图解构、流程图辅助、思维纠偏。
3. **代码与调试智能体 (Agent C)**：负责结构模版提供、语法纠错、P-O-E预测观察解释。
4. **评估与迁移智能体 (Agent D)**：负责多维评价、反思引导、变式题生成、全课总结。

---

### 智能体详细构建方案

基于你提供的教学案例图片  以及“一次提问不超过2个”和“填空式交互”的严格约束，我为你重新梳理了 **Agent A（情境与任务智能体）** 的详细设计方案。

这个阶段的核心目标是：**从生活情境中剥离出数据和逻辑，并完成任务分解。**

---

### **Agent A：情境引导与任务拆解智能体**

#### **1. 功能模块总结**

根据图片内容，该智能体主要包含三个核心功能状态：

1. 
**情境生成器 (Storyteller):** 接收主题“公园购票”，输出包含具体数值（138cm, 116cm, 120cm边界, 10元, 5元）的情境对话 。

2. 
**S-T-W 诊断支架 (The Scaffolder):** 当学生点击“求助”或回答模糊时，启动 S(See)-T(Think)-W(Wonder) 流程，强制学生关注数据 。

3. 
**递进式任务分解 (The Step-by-Step Guide):** 将原本复杂的“基础-深入-综合”问题拆解为 3 轮具体的“填空题”，引导学生构建 Input-Process-Output 模型 。


---

#### **2. 交互流程与提示词 (Prompt) 设计**

为了满足你的要求（一次只问一两个问题、提供输入框），我将交互设计为**“回合制填空游戏”**。

##### **阶段一：情境呈现 (无需学生回答)**

* **触发条件：** 课程开始，或学生输入“公园购票”。
* **系统提示词 (System Output)：**
> ## **【情境：周末公园】** 小智和妹妹去公园参加科技活动。售票口发生了以下对话： 🧒 **小智：** “我要买两张票，我和妹妹。我身高 **138** 厘米，妹妹 **116** 厘米。” 🎫 **售票员：** “你妹妹身高小于 **120** 厘米，买半价票 **5元**。你超过了 **120** 厘米，买全价票 **10元**。一共15元。”
> 
> 
> 🤖 **任务：** 如果你是售票员，你的大脑是怎么工作的？我们来拆解一下这个过程。

##### **阶段二：关键数据提取 (S-T-W 模式)**

* 
**设计意图：** 解决图片中的“S-T-W支架”，让学生提取关键数据 。


* **交互形式：** 单一问题 + 指定输入框。
* **系统提问：**
> 首先，我们需要用“计算机的眼睛”看世界。在这个故事里，最关键的**判断标准**（那条红线）是多少？两个**票价**分别是多少？
> 请在下方填入数字：


* **UI 输入框设计：**
> 📏 判断标准身高：[ 填写数字 ] cm
> 💰 半价票金额： [ 填写数字 ] 元
> 💰 全价票金额： [ 填写数字 ] 元



##### **阶段三：逻辑模型构建 (递进式拆解)**

这里将图片中的“基础→深入→综合”拆解为三个独立的交互回合，严格遵守“一次不超过2问”。

**回合 1：确定输入与输出 (基础)**

* 
**设计意图：** 对应图片中“第一步获取什么信息？最后一步输出什么结果？” 。


* **系统提问：**
> 很好！现在我们来设计这一套“自动售票系统”。
> 对于每一个来到窗口的游客，程序**第一步**必须知道的一个数据是什么？**最后**要告诉游客的一个结果是什么？


* **UI 输入框设计：**
> 📥 输入 (Input)：游客的 [ ________ ]
> 📤 输出 (Output)：应付的 [ ________ ]



**回合 2：寻找判断逻辑 (深入)**

* 
**设计意图：** 对应图片中“关键的判断动作是什么？依据的数字标准是多少？” 。


* **系统提问：**
> 关键的一步来了！在“输入”和“输出”之间，我们需要做一个**判断**。
> 请补充完整的判断规则：


* **UI 输入框设计：**
> 如果 身高 [ > / < ] 120：
>     那么，票价 = [ ________ ]
> 否则 (即另一半情况)：
>     那么，票价 = [ ________ ]



**回合 3：总结与确认 (综合)**

* 
**设计意图：** 对应图片中“总结输出分解模型” 。


* **系统动作：** 智能体自动汇总学生之前的填空，生成一段完整的伪代码或描述，请求学生确认。
* **系统输出：**
> 根据你的设计，我们的算法逻辑如下：


> 1. **获取**游客身高。
> 2. **判断**：若身高 < 120，票价设为5元；否则票价设为10元。
> 3. **输出**票价。
> 
> 

> 这个逻辑这是否涵盖了所有身高的情况（比如刚好120cm）？
> [ 是 / 否，我想修改 ]

---

#### **3. 给开发者的 System Prompt (后端配置)**

你需要将以下指令灌输给 **Agent A**，让它具备上述行为逻辑：

```markdown
# Role
你是一个小学/初中信息科技课的引导助教。你的任务是帮助学生将自然语言故事转化为结构化的算法逻辑。

# Rules
1. **严格分步**：绝对不要一次性抛出所有问题。必须等待学生完成当前步骤的填空后，再进行下一步。
2. **填空引导**：在需要学生回答时，生成显式的填空占位符（如 [ 填入数字 ]），引导学生只关注关键数据。
3. **S-T-W检测**：
   - 阶段二中，如果学生填写的“判断标准”不是120，或者“票价”填错。
   - 立即触发反馈：“哎呀，再仔细看看售票员的话。她说‘超过’多少厘米要买全价票？”
4. **模型一致性**：始终围绕 "Input(身高) -> Process(判断120) -> Output(价格)" 这一模型进行引导。

# Interaction Style
- 语气亲切、鼓励性强。
- 使用 Emoji 增加趣味性。
- 如果学生卡住，提供具体的选项（如：是身高还是体重？）。

```

#### **4. 总结：什么时候需要学生回答？**

| 步骤 | 环节名称 | 是否需要学生回答 | 回答方式 | 限制条件 |
| --- | --- | --- | --- | --- |
| 1 | 情境导入 | ❌ 不需要 | (阅读对话) | 无 |
| 2 | 数据提取 | ✅ 需要 | **填空**：填入3个关键数字 | 必须填对数字才能继续 |
| 3 | I/O分析 | ✅ 需要 | **填空**：填入2个关键词 (身高、价格) | 引导关注输入输出两端 |
| 4 | 规则完善 | ✅ 需要 | **填空/选择**：补充 If...Else... 的逻辑 | 最多同时处理两个分支 |
| 5 | 逻辑确认 | ✅ 需要 | **点击按钮**：确认或修改 | 简单的二选一 |



#### 2. 逻辑与设计智能体 (Agent B: Logic & Design Mentor)

**对应教学环节：** 新知学习、算法设计
**核心目标：** 跨越语义鸿沟，通过可视化表征（流程图/概念图）强化逻辑。

* **功能需求：**
1. **概念讲解与类比：** 用通俗语言解释 `if-else`，针对理解障碍提供类比（如：红绿灯、垃圾分类）。
2. 
**流程图辅助：** 生成或辅助补全双分支结构的流程图 。


3. **概念图生成：** 输出本课的知识结构图（Mermaid格式或图片）。


* **构建与Prompt方案：**
* **角色设定：** “你是一位算法可视化专家，擅长用图形解释逻辑。”
* **工具调用（Function Calling）：** 建议集成 **Mermaid.js** 渲染引擎。
* *Prompt示例：* “请生成一个双分支流程图的Mermaid代码。判断条件是‘身高>120’，True分支输出‘全价’，False分支输出‘半价’。”


* **思维纠偏策略：**
* 当学生询问“为什么要缩进”时，不要只讲语法规范，要强调“归属关系”（就像孩子属于家庭一样，代码块属于if）。





#### 3. 代码与调试智能体 (Agent C: Coding & Debugging Coach)

**对应教学环节：** 编写代码、运行调试
**核心目标：** 降低非本质认知负荷，培养“预测-观察-解释”（P-O-E）能力。

* **功能需求：**
1. 
**完形填空支架：** 提供半成品代码框架，只留出逻辑关键点（条件、分支内容）供学生填写 。


2. **语法哨兵：** 实时检测 Python 常见错误（冒号丢失、缩进错误、中文符号）。
3. **P-O-E 引导链：** 在代码运行前，强制拦截，询问“如果输入120会发生什么？”；运行后引导对比差异。


* **构建与Prompt方案：**
* **角色设定：** “你是一位严谨的代码教练，你不会直接给答案，而是通过提示引导学生发现Bug。”
* **输入处理：** 接收学生的 Python 代码段。
* **处理逻辑（Chain of Thought）：**
1. **Static Analysis (静态分析):** 检查 `if` 行尾是否有 `:`, 检查 `print` 是否缩进。如果错误，输出：“我注意到你的 if 语句后面好像少了个小尾巴（冒号），检查一下？”
2. **Logic Simulation (逻辑模拟):** 如果代码通过静态检查，进入 P-O-E 模式。
* *Question:* “先别急着运行。并在脑海中跑一遍：如果身高输入 120，你的程序会打印什么？”
* *Feedback:* 根据学生回答与实际代码逻辑的对比，给出反馈。

#### 4. 评估与迁移智能体 (Agent D: Assessment & Transfer Master)

**对应教学环节：** 评估反思、迁移应用、总结
**核心目标：** 促进深度学习，完成知识迁移。

* **功能需求：**
1. 
**多维评分：** 根据“功能实现、逻辑正确、代码规范、创新意识”四个维度打分 。


2. **反思引导：** 提问“今天遇到的最大困难是什么？你是怎么解决的？”
3. 
**变式生成：** 生成新的应用题（如：根据气温判断是否开空调，根据人数判断是否打折）及配套的单选题（概念、语法、逻辑） 。


4. **思维导图总结：** 协助生成全课的知识图谱。


* **构建与Prompt方案：**
* **角色设定：** “你是一位富有洞察力的教育评价专家。”
* **评价量规（Rubric）植入：**
* 在 System Prompt 中植入具体的评分标准（例如：有缩进得20分，逻辑覆盖边界值得30分）。


* **动态题库生成：**
* *Prompt:* “基于 `if-else` 双分支结构，生成一个生活场景的编程应用题。要求：场景不同于‘购票’，但逻辑结构一致（二选一）。”





---

### 技术实现建议（结合你的技术栈）

鉴于你之前提到正在使用 **Flask** 和 **Graph-LLM**：

1. **后端架构 (Flask):**
* 建立 4 个独立的 API Endpoint (e.g., `/api/agent/scenario`, `/api/agent/code_coach`)。
* 使用 Session 或 Database (Supabase) 存储学生的当前状态（State），以便智能体知道学生处于哪个教学环节。


2. **大模型编排 (Orchestration):**
* 可以使用 **LangChain** 或 **Flowise** 来管理这些 Prompt 链。
* 对于 **Agent C (代码智能体)**，建议在 Prompt 中加入 Python 代码解释器的能力（或者简单的正则匹配），以确保对语法错误的判断是准确的，而不完全依赖 LLM 的幻觉。


3. **前端交互:**
* 建议采用 **双栏布局**：左侧是聊天窗口（与智能体互动），右侧是代码编辑器/流程图画布。
* Agent A 和 B 的输出可以包含特殊的 Tag（如 `<render_flowchart>`），前端解析后自动渲染出图形 。


### 你可以做的下一步

你可以选择其中**最核心的一个智能体**（比如 **Agent C 代码与调试智能体**，因为它涉及 P-O-E 这种深度的认知策略），通过 Flask 快速搭建一个 Demo。

如果你需要，我可以为你撰写 **Agent C 具体的 System Prompt** 以及它处理 P-O-E 环节的伪代码逻辑。你想先看这个吗？